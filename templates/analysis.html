<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analysis - Valid-X</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/global.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/analysis.css') }}"
    />

    <!-- Inline CSS for Formatted Content -->
    <style>
      /* Formatted Content in Accordions */
      .formatted-content {
        padding: 20px;
        background: var(--card-bg);
        border-radius: 8px;
        line-height: 1.8;
        color: var(--text-primary);
      }

      .formatted-content p {
        margin-bottom: 16px;
        text-align: justify;
      }

      .formatted-content p:last-child {
        margin-bottom: 0;
      }

      /* Accordion Icon Animation */
      .accordion-icon {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-block;
        margin-left: auto;
      }

      .accordion-header.active .accordion-icon {
        transform: rotate(180deg);
      }

      /* ========== NEW: INVESTOR DECISION STYLES ========== */
      .investor-section {
        margin-top: 40px;
        padding: 30px;
        background: linear-gradient(
          135deg,
          rgba(6, 182, 212, 0.1),
          rgba(16, 185, 129, 0.1)
        );
        border-radius: 16px;
        border: 2px solid var(--accent);
      }

      .investor-section-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .investor-section-header h2 {
        font-size: 2rem;
        color: var(--accent);
        margin-bottom: 10px;
      }

      .investor-decision-banner {
        text-align: center;
        padding: 30px;
        border-radius: 12px;
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 20px;
        animation: fadeInScale 0.6s ease-out;
      }

      .investor-decision-banner.invest {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
      }

      .investor-decision-banner.hold {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
      }

      .investor-decision-banner.not-invest {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
      }

      .confidence-display {
        text-align: center;
        margin: 20px 0;
        font-size: 1.2rem;
      }

      .confidence-bar {
        width: 100%;
        height: 12px;
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
        overflow: hidden;
        margin: 10px 0;
      }

      .confidence-fill {
        height: 100%;
        background: linear-gradient(90deg, #06b6d4, #10b981);
        transition: width 1s ease-out;
        border-radius: 6px;
      }

      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-logo">
          <span class="logo-icon">üîç</span>
          <span class="logo-text">Valid-X</span>
        </div>
        <div class="nav-links">
          <span class="user-greeting"
            >Hello, <strong>{{ user_name }}</strong></span
          >
          <a href="/logout" class="btn-logout">Logout</a>
          <button
            id="themeToggle"
            class="theme-toggle"
            aria-label="Toggle theme"
          >
            <span class="sun-icon">‚òÄÔ∏è</span>
            <span class="moon-icon">üåô</span>
          </button>
        </div>
      </div>
    </nav>

    <div class="analysis-container">
      <!-- Input Section -->
      <section id="inputSection" class="input-section">
        <div class="section-header">
          <h1>Validate Your Startup Idea</h1>
          <p>
            Enter your startup idea and get comprehensive AI-powered analysis
            with visual insights
          </p>
        </div>

        <div class="input-card">
          <div class="card-header">
            <span class="card-icon">üí°</span>
            <h2>Describe Your Idea</h2>
          </div>
          <textarea
            id="startupIdea"
            placeholder="Example: A mobile app that connects freelance designers with small businesses for quick, affordable branding projects. The platform would use AI to match designers with clients based on style preferences, budget, and timeline..."
            rows="12"
          ></textarea>
          <div class="character-count">
            <span id="charCount">0</span> / 1500 characters
          </div>
          <button id="validateBtn" class="btn-primary btn-large">
            <span class="btn-text">Analyze Idea</span>
            <span class="btn-icon">‚Üí</span>
          </button>
        </div>

        <div class="tips-card">
          <h3>üí≠ Tips for Better Results</h3>
          <ul>
            <li>
              Be specific about your target market and customer pain points
            </li>
            <li>Mention your unique value proposition</li>
            <li>Include business model details if possible</li>
            <li>Describe any competitive advantages</li>
          </ul>
        </div>
      </section>

      <!-- Loading Section -->
      <section id="loadingSection" class="loading-section hidden">
        <div class="loading-card">
          <div class="loading-animation">
            <div class="orbit-spinner">
              <div class="orbit"></div>
              <div class="orbit"></div>
              <div class="orbit"></div>
            </div>
          </div>
          <h2>Analyzing Your Startup Idea</h2>
          <div class="analysis-steps">
            <div class="step active" id="step1">
              <span class="step-icon">üìä</span>
              <span class="step-text">Market Analysis</span>
              <span class="step-loader"></span>
            </div>
            <div class="step" id="step2">
              <span class="step-icon">‚öîÔ∏è</span>
              <span class="step-text">Competition Research</span>
              <span class="step-loader"></span>
            </div>
            <div class="step" id="step3">
              <span class="step-icon">‚ö†Ô∏è</span>
              <span class="step-text">Risk Assessment</span>
              <span class="step-loader"></span>
            </div>
            <div class="step" id="step4">
              <span class="step-icon">üíº</span>
              <span class="step-text">Strategic Advisory</span>
              <span class="step-loader"></span>
            </div>
          </div>
          <p class="loading-subtext">This may take 30-60 seconds</p>
        </div>
      </section>

      <!-- Results Section with Charts -->
      <section id="resultsSection" class="results-section hidden">
        <!-- Decision Banner -->
        <div id="decisionBanner" class="decision-banner"></div>

        <!-- Startup Idea Summary -->
        <div class="result-card idea-card">
          <div class="card-header">
            <span class="card-icon">üí°</span>
            <h2>Your Startup Idea</h2>
          </div>
          <div id="ideaContent" class="card-content"></div>
        </div>

        <!-- Strategic Advice -->
        <div class="result-card advice-card">
          <div class="card-header">
            <span class="card-icon">üéØ</span>
            <h2>Strategic Recommendations</h2>
          </div>
          <div id="adviceContent" class="card-content"></div>
        </div>

        <!-- Dashboard Grid with Charts -->
        <div class="dashboard-grid">
          <!-- Market Analysis Chart -->
          <div class="chart-card">
            <div class="chart-header">
              <span class="chart-icon">üìä</span>
              <h2>Market Analysis Overview</h2>
            </div>
            <div class="chart-container">
              <canvas id="marketChart"></canvas>
            </div>
            <div class="chart-insights" id="marketInsights">
              <h3>Key Insights:</h3>
              <ul id="marketInsightsList"></ul>
            </div>
          </div>

          <!-- Competition Analysis Chart -->
          <div class="chart-card">
            <div class="chart-header">
              <span class="chart-icon">‚öîÔ∏è</span>
              <h2>Competitive Landscape</h2>
            </div>
            <div class="chart-container">
              <canvas id="competitionChart"></canvas>
            </div>
            <div class="chart-insights" id="competitionInsights">
              <h3>Competitive Position:</h3>
              <ul id="competitionInsightsList"></ul>
            </div>
          </div>

          <!-- Risk Assessment Chart -->
          <div class="chart-card">
            <div class="chart-header">
              <span class="chart-icon">‚ö†Ô∏è</span>
              <h2>Risk Assessment Matrix</h2>
            </div>
            <div class="chart-container">
              <canvas id="riskChart"></canvas>
            </div>
            <div class="chart-insights" id="riskInsights">
              <h3>Risk Factors:</h3>
              <ul id="riskInsightsList"></ul>
            </div>
          </div>

          <!-- Overall Score Gauge -->
          <div class="chart-card">
            <div class="chart-header">
              <span class="chart-icon">‚≠ê</span>
              <h2>Viability Score</h2>
            </div>
            <div class="chart-container">
              <canvas id="scoreChart"></canvas>
            </div>
            <div class="score-details" id="scoreDetails">
              <div class="score-item">
                <span class="score-label">Market Opportunity</span>
                <span class="score-value" id="marketScore">--</span>
              </div>
              <div class="score-item">
                <span class="score-label">Competition Level</span>
                <span class="score-value" id="competitionScore">--</span>
              </div>
              <div class="score-item">
                <span class="score-label">Risk Level</span>
                <span class="score-value" id="riskScore">--</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Detailed Analysis Reports -->
        <div class="detailed-analysis">
          <h2>üìÑ Detailed Analysis Reports</h2>

          <div class="accordion-item">
            <button class="accordion-header" onclick="toggleAccordion(this)">
              <span>üìä Full Market Analysis</span>
              <span class="accordion-icon">‚ñº</span>
            </button>
            <div class="accordion-content">
              <div id="fullMarketAnalysis" class="formatted-content">
                Loading market analysis...
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <button class="accordion-header" onclick="toggleAccordion(this)">
              <span>‚öîÔ∏è Complete Competition Analysis</span>
              <span class="accordion-icon">‚ñº</span>
            </button>
            <div class="accordion-content">
              <div id="fullCompetitionAnalysis" class="formatted-content">
                Loading competition analysis...
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <button class="accordion-header" onclick="toggleAccordion(this)">
              <span>‚ö†Ô∏è Comprehensive Risk Assessment</span>
              <span class="accordion-icon">‚ñº</span>
            </button>
            <div class="accordion-content">
              <div id="fullRiskAssessment" class="formatted-content">
                Loading risk assessment...
              </div>
            </div>
          </div>
        </div>

        <!-- ========== NEW: DECISION FOR INVESTORS SECTION ========== -->
        <div class="investor-section">
          <div class="investor-section-header">
            <h2>üíº Decision for Investors</h2>
            <p>
              Comprehensive investor analysis based on competitive intelligence
              and financial viability
            </p>
          </div>

          <!-- Investor Decision Banner -->
          <div id="investorDecisionBanner" class="investor-decision-banner">
            Analyzing...
          </div>

          <!-- Confidence Display -->
          <div class="confidence-display">
            <strong>Confidence Level:</strong>
            <span id="investorConfidence">--</span>%
            <div class="confidence-bar">
              <div
                id="confidenceFill"
                class="confidence-fill"
                style="width: 0%"
              ></div>
            </div>
          </div>

          <!-- Investor Insights -->
          <div class="result-card">
            <div class="card-header">
              <span class="card-icon">üìù</span>
              <h3>Investment Reasoning</h3>
            </div>
            <div id="investorReasoning" class="card-content formatted-content">
              Loading investment analysis...
            </div>
          </div>

          <!-- Competitor Intelligence Dashboard -->
          <div class="detailed-analysis">
            <div class="accordion-item">
              <button class="accordion-header" onclick="toggleAccordion(this)">
                <span>üè¢ Competitor Intelligence Dashboard</span>
                <span class="accordion-icon">‚ñº</span>
              </button>
              <div class="accordion-content">
                <div class="chart-container">
                  <canvas id="competitorRadarChart"></canvas>
                </div>
                <div id="competitorIntelligenceData" class="formatted-content">
                  Loading competitor intelligence...
                </div>
              </div>
            </div>

            <!-- Financial Viability Estimator -->
            <div class="accordion-item">
              <button class="accordion-header" onclick="toggleAccordion(this)">
                <span>üí∏ Financial Viability Estimator</span>
                <span class="accordion-icon">‚ñº</span>
              </button>
              <div class="accordion-content">
                <div class="chart-container">
                  <canvas id="revenueLineChart"></canvas>
                </div>
                <div class="chart-container" style="margin-top: 20px">
                  <canvas id="costRevenueBarChart"></canvas>
                </div>
                <div id="financialViabilityData" class="formatted-content">
                  Loading financial viability...
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button id="newAnalysisBtn" class="btn-secondary btn-large">
            <span class="btn-icon">üîÑ</span>
            Analyze Another Idea
          </button>
          <button id="downloadBtn" class="btn-outline btn-large">
            <span class="btn-icon">üì•</span>
            Download Report
          </button>
        </div>
      </section>

      <!-- Error Section -->
      <section id="errorSection" class="error-section hidden">
        <div class="error-card">
          <div class="error-icon">‚ùå</div>
          <h2>Analysis Failed</h2>
          <p id="errorMessage"></p>
          <button id="retryBtn" class="btn-primary">Try Again</button>
        </div>
      </section>
    </div>

    <!-- JavaScript Libraries (CORRECT ORDER) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script src="{{ url_for('static', filename='js/analysis.js') }}"></script>

    <!-- Inline JS for Text Formatting -->
    <script>
      function formatTextIntoParagraphs(text) {
        const cleaned = text
          .replace(/[^\x00-\x7F]/g, " ")
          .replace(/#{1,6}\s*/g, "")
          .replace(/\*\*|__/g, "")
          .replace(/\*|_/g, "")
          .replace(/\|/g, " ")
          .replace(/[-]{2,}/g, " ")
          .replace(/[+]/g, " ")
          .replace(/\[|\]/g, "")
          .replace(/\{|\}/g, "")
          .replace(/[-_]{3,}/g, " ")
          .replace(/^\s*[-*+]\s*/gm, "")
          .replace(/::/g, ":")
          .replace(/;;/g, ";")
          .replace(/\s+/g, " ")
          .trim();

        const sentences = cleaned.match(/[^.!?]+[.!?]+/g) || [cleaned];
        const paragraphs = [];
        let currentParagraph = [];

        sentences.forEach((sentence, index) => {
          currentParagraph.push(sentence.trim());

          if (currentParagraph.length >= 3 || index === sentences.length - 1) {
            if (currentParagraph.length > 0) {
              paragraphs.push(currentParagraph.join(" "));
            }
            currentParagraph = [];
          }
        });

        return paragraphs.map((p) => `<p>${p}</p>`).join("");
      }
    </script>
  </body>
</html>
